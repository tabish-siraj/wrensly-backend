generator client {
  provider        = "prisma-client-js"
  output          = "../src/generated/prisma"
  previewFeatures = ["strictUndefinedChecks"]
}

datasource db {
  provider = "postgresql"
}

model User {
  id                       String     @id @default(cuid())
  username                 String?    @unique
  email                    String     @unique
  password                 String
  createdAt                DateTime   @default(now())
  updatedAt                DateTime   @updatedAt
  deletedAt                DateTime?
  isActive                 Boolean    @default(true)
  isAdmin                  Boolean    @default(false)
  isBanned                 Boolean    @default(false)
  isVerified               Boolean    @default(false)
  passwordResetExpires     DateTime?
  passwordResetToken       String?
  isEmailVerified          Boolean    @default(false)
  emailVerificationExpires DateTime?
  emailVerificationToken   String?
  bookmarks                Bookmark[]
  feed                     Feed[]
  followers                Follow[]   @relation("Follower")
  following                Follow[]   @relation("Following")
  likes                    Like[]
  posts                    Post[]
  profile                  Profile?
}

model Profile {
  id          String              @id @default(cuid())
  userId      String              @unique
  firstName   String?
  lastName    String?
  dateOfBirth DateTime?           @db.Date
  gender      String?
  bio         String?
  avatar      String?
  city        String?
  state       String?
  country     String?
  phone       String?
  website     String?
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @default(now())
  deletedAt   DateTime?
  user        User                @relation(fields: [userId], references: [id])
  attachments ProfileAttachment[]
}

model Post {
  id          String           @id @default(cuid())
  content     String?
  userId      String
  parentId    String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @default(now())
  deletedAt   DateTime?
  rootId      String?
  type        PostType         @default(POST)
  bookmarks   Bookmark[]
  feeds       Feed[]
  likes       Like[]
  parent      Post?            @relation("ParentPost", fields: [parentId], references: [id])
  children    Post[]           @relation("ParentPost")
  user        User             @relation(fields: [userId], references: [id])
  attachments PostAttachment[]

  @@index([userId])
  @@index([createdAt])
  @@index([parentId])
  @@index([rootId])
}

model Like {
  id        String    @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime  @default(now())
  deletedAt DateTime?
  post      Post      @relation(fields: [postId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@unique([userId, postId])
  @@index([userId])
  @@index([postId])
}

model Bookmark {
  id        String    @id @default(cuid())
  postId    String
  userId    String
  createdAt DateTime  @default(now())
  deletedAt DateTime?
  post      Post      @relation(fields: [postId], references: [id])
  user      User      @relation(fields: [userId], references: [id])

  @@unique([userId, postId])
  @@index([userId])
}

model Follow {
  id          String    @id @default(cuid())
  followerId  String
  followingId String
  createdAt   DateTime  @default(now())
  deletedAt   DateTime?
  follower    User      @relation("Follower", fields: [followerId], references: [id])
  following   User      @relation("Following", fields: [followingId], references: [id])

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Feed {
  id        String   @id @default(cuid())
  userId    String
  postId    String
  createdAt DateTime @default(now())
  post      Post     @relation(fields: [postId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt(sort: Desc)])
}

model Attachment {
  id                 String              @id @default(cuid())
  url                String
  type               String
  createdAt          DateTime            @default(now())
  deletedAt          DateTime?
  postAttachments    PostAttachment[]
  profileAttachments ProfileAttachment[]
}

model ProfileAttachment {
  id           String     @id @default(cuid())
  profileId    String
  attachmentId String
  createdAt    DateTime   @default(now())
  deletedAt    DateTime?
  attachment   Attachment @relation(fields: [attachmentId], references: [id])
  profile      Profile    @relation(fields: [profileId], references: [id])

  @@index([profileId])
}

model PostAttachment {
  id           String     @id @default(cuid())
  postId       String
  attachmentId String
  createdAt    DateTime   @default(now())
  deletedAt    DateTime?
  attachment   Attachment @relation(fields: [attachmentId], references: [id])
  post         Post       @relation(fields: [postId], references: [id])

  @@index([postId])
}

enum PostType {
  POST
  COMMENT
  QUOTE
  REPOST
}
